# Глава 7: Многоагентное сотрудничество

## Обзор паттерна

Многоагентное сотрудничество — паттерн, где несколько специализированных агентов работают совместно для решения сложных задач, используя распределение ответственности и координацию.

**Преимущества:**
- Специализация агентов на конкретных доменах
- Параллельная обработка независимых задач
- Модульность и переиспользование компонентов
- Масштабируемость системы

## Архитектурные паттерны

1. **Последовательная передача:** Агенты работают в конвейере
   - Агент A → Агент B → Агент C

2. **Иерархическая структура:** Координатор управляет подагентами
   - Менеджер → Специалист 1, Специалист 2, Специалист 3

3. **Горизонтальное сотрудничество:** Равноправные агенты совместно решают задачу
   - Агент 1 ↔ Агент 2 ↔ Агент 3

4. **Producer-Critic:** Создатель и рецензент
   - Продюсер → Критик → Улучшенный результат

## Практические применения

- **Исследования:** Поисковик + Суммаризатор + Аналитик + Автор отчёта
- **Разработка ПО:** Аналитик + Генератор кода + Тестировщик + Документатор
- **Маркетинг:** Исследователь рынка + Копирайтер + Дизайнер + Планировщик
- **Финансы:** Сборщик данных + Аналитик настроений + Технический аналитик + Консультант
- **Поддержка клиентов:** Первая линия + Технический специалист + Эскалация
- **Анализ сетей:** Мониторинг + Диагностика + Восстановление

## Практический пример кода

```python
from langchain_openai import ChatOpenAI
from langchain_core.prompts import ChatPromptTemplate

llm = ChatOpenAI(model="gpt-4o", temperature=0.7)

# Определение специализированных агентов
researcher = ChatPromptTemplate.from_template(
    "Ты исследователь. Найди ключевые факты о: {topic}"
) | llm

writer = ChatPromptTemplate.from_template(
    """Ты писатель. Создай статью используя:
    Исследование: {research}
    Тема: {topic}"""
) | llm

editor = ChatPromptTemplate.from_template(
    """Ты редактор. Улучши статью:
    {article}
    
    Исправь ошибки и улучши стиль."""
) | llm

# Координация агентов
def multi_agent_workflow(topic):
    # Шаг 1: Исследование
    research = researcher.invoke({"topic": topic}).content
    print(f"Исследование: {research[:100]}...")
    
    # Шаг 2: Написание
    article = writer.invoke({
        "topic": topic, 
        "research": research
    }).content
    print(f"Статья: {article[:100]}...")
    
    # Шаг 3: Редактирование
    final = editor.invoke({"article": article}).content
    return final

result = multi_agent_workflow("Квантовые компьютеры")
print(result)
```

## Координация и коммуникация

**Фреймворки:**
- **Crew AI:** Специализирован на многоагентных системах
- **Google ADK:** Нативная поддержка мультиагентности
- **LangGraph:** Графовая структура для координации

**Механизмы:**
- Общая память/состояние
- Очереди сообщений
- Синхронизация событий

## Ключевые выводы

- Многоагентность распределяет сложность между специалистами
- Поддерживает последовательную, иерархическую и горизонтальную архитектуры
- Применима в исследованиях, разработке, маркетинге, финансах
- Требует координации и чётких протоколов коммуникации
- Фреймворки Crew AI и ADK упрощают реализацию
- Повышает модульность, специализацию и масштабируемость
