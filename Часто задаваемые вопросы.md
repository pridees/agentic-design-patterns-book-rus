### **Часто задаваемые вопросы: Агентные паттерны проектирования**

**Что такое "агентный паттерн проектирования"?** Агентный паттерн проектирования — это многоразовое высокоуровневое решение общей проблемы, с которой сталкиваются при создании интеллектуальных автономных систем (агентов). Эти паттерны обеспечивают структурированную основу для проектирования поведения агентов, подобно тому, как паттерны проектирования программного обеспечения делают для традиционного программирования. Они помогают разработчикам создавать более надежных, предсказуемых и эффективных AI-агентов.

**Какова основная цель этого руководства?** Руководство направлено на предоставление практического, практического введения в проектирование и создание агентных систем. Оно выходит за рамки теоретических обсуждений, предлагая конкретные архитектурные чертежи, которые разработчики могут использовать для создания агентов, способных к сложному, целеориентированному поведению надежным способом.

**Кто является целевой аудиторией для этого руководства?** Это руководство написано для AI-разработчиков, инженеров-программистов и архитекторов систем, которые создают приложения с большими языковыми моделями (LLM) и другими AI-компонентами. Оно предназначено для тех, кто хочет перейти от простых взаимодействий промпт-ответ к созданию сложных, автономных агентов.

**4. Какие ключевые агентные паттерны обсуждаются?** Основываясь на содержании, руководство охватывает несколько ключевых паттернов, включая:

- **Рефлексия:** Способность агента критиковать свои собственные действия и выводы для улучшения производительности.
- **Планирование:** Процесс разбиения сложной цели на меньшие, управляемые шаги или задачи.
- **Использование инструментов:** Паттерн агента, использующего внешние инструменты (такие как интерпретаторы кода, поисковые системы или другие API) для получения информации или выполнения действий, которые он не может сделать самостоятельно.
- **Многоагентное сотрудничество:** Архитектура для совместной работы нескольких специализированных агентов для решения проблемы, часто включающая "лидера" или "оркестратора" агента.
- **Человек в контуре:** Интеграция человеческого надзора и вмешательства, позволяющая обратную связь, коррекцию и одобрение действий агента.

**Почему "планирование" является важным паттерном?** Планирование имеет решающее значение, поскольку оно позволяет агенту решать сложные многошаговые задачи, которые не могут быть решены одним действием. Создавая план, агент может поддерживать связную стратегию, отслеживать свой прогресс и обрабатывать ошибки или неожиданные препятствия структурированным образом. Это предотвращает "застревание" агента или отклонение от конечной цели пользователя.

**В чем разница между "инструментом" и "навыком" для агента?** Хотя термины часто используются взаимозаменяемо, "инструмент" обычно относится к внешнему ресурсу, к которому агент может обратиться (например, API погоды, калькулятор). "Навык" — это более интегрированная способность, которую агент изучил, часто комбинируя использование инструментов с внутренним рассуждением для выполнения конкретной функции (например, навык "бронирования рейса" может включать использование календарных и авиационных API).

**Как паттерн "Рефлексия" улучшает производительность агента?** Рефлексия действует как форма самокоррекции. После генерации ответа или завершения задачи агент может быть промптирован для рецензирования своей работы, проверки ошибок, оценки качества против определенных критериев или рассмотрения альтернативных подходов. Этот итеративный процесс улучшения помогает агенту производить более точные, релевантные и качественные результаты.

**В чем основная идея паттерна Рефлексии?** Паттерн Рефлексии дает агенту способность отступить и критиковать свою собственную работу. Вместо производства финального вывода за один раз агент генерирует черновик и затем "рефлектирует" над ним, выявляя недостатки, отсутствующую информацию или области для улучшения. Этот процесс самокоррекции является ключом к повышению качества и точности его ответов.

**Почему простая "цепочка промптов" недостаточна для качественного вывода?** Простая цепочка промптов (где вывод одного промпта становится вводом для следующего) часто слишком базовая. Модель может просто перефразировать свой предыдущий вывод без подлинного улучшения. Истинный паттерн Рефлексии требует более структурированной критики, промптирования агента для анализа своей работы против конкретных стандартов, проверки логических ошибок или верификации фактов.

**Какие два основных типа рефлексии упоминаются в этой главе?** Глава обсуждает две первичные формы рефлексии:

- **Рефлексия "Проверь свою работу":** Это базовая форма, где агент просто просят рецензировать и исправить свой предыдущий вывод. Это хорошая отправная точка для ловли простых ошибок.
- **Рефлексия "Внутренний критик":** Это более продвинутая форма, где используется отдельный агент-"критик" (или выделенный промпт) для оценки вывода "рабочего" агента. Этот критик может быть дан конкретные критерии для поиска, приводя к более строгим и целенаправленным улучшениям.

**Как рефлексия помогает в уменьшении "галлюцинаций"?** Промптируя агента рецензировать свою работу, особенно сравнивая его утверждения против известного источника или проверяя свои собственные шаги рассуждения, паттерн Рефлексии может значительно уменьшить вероятность галлюцинаций (выдумывания фактов). Агент вынужден быть более заземленным в предоставленном контексте и менее склонным генерировать неподдерживаемую информацию.

**Может ли паттерн Рефлексии применяться более одного раза?** Да, рефлексия может быть итеративным процессом. Агент может быть сделан для рефлексии над своей работой несколько раз, с каждым циклом улучшая вывод дальше. Это особенно полезно для сложных задач, где первая или вторая попытка может все еще содержать тонкие ошибки или может быть существенно улучшена.

**Что такое паттерн Планирования в контексте AI-агентов?** Паттерн Планирования включает включение агента разбивать сложную высокоуровневую цель в последовательность меньших, выполнимых шагов. Вместо попытки решить большую проблему сразу, агент сначала создает "план", а затем выполняет каждый шаг в плане, что является гораздо более надежным подходом.

**Почему планирование необходимо для сложных задач?** LLM могут бороться с задачами, которые требуют множественных шагов или зависимостей. Без плана агент может потерять след общей цели, пропустить решающие шаги или не справиться с выводом одного шага как вводом для следующего. План обеспечивает четкую дорожную карту, гарантируя, что все требования оригинального запроса выполнены в логическом порядке.

**Каков общий способ реализации паттерна Планирования?** Общая реализация — иметь агента сначала генерировать список шагов в структурированном формате (как JSON массив или пронумерованный список). Система может затем итерировать через этот список, выполняя каждый шаг один за другим и передавая результат обратно агенту для информирования следующего действия.

**Как агент обрабатывает ошибки или изменения во время выполнения?** Надежный паттерн планирования позволяет для динамических корректировок. Если шаг терпит неудачу или ситуация изменяется, агент может быть промптирован "перепланировать" из текущего состояния. Он может анализировать ошибку, модифицировать оставшиеся шаги или даже добавлять новые для преодоления препятствия.

**Видит ли пользователь план?** Это выбор дизайна. Во многих случаях показ плана пользователю сначала для одобрения является отличной практикой. Это выравнивается с паттерном "Человек в контуре", давая пользователю прозрачность и контроль над предложенными действиями агента перед их выполнением.

**Что влечет паттерн "Использование инструментов"?** Паттерн Использования инструментов позволяет агенту расширять свои возможности, взаимодействуя с внешним программным обеспечением или API. Поскольку знания LLM статичны и он не может выполнять действия в реальном мире самостоятельно, инструменты дают ему доступ к живой информации (например, Google Search), проприетарным данным (например, базе данных компании) или способность выполнять действия (например, отправить email, забронировать встречу).

**Как агент решает, какой инструмент использовать?** Агенту обычно дается список доступных инструментов вместе с описаниями того, что каждый инструмент делает и какие параметры он требует. Когда сталкивается с запросом, который он не может обработать своими внутренними знаниями, способность рассуждения агента позволяет ему выбрать наиболее подходящий инструмент из списка для выполнения задачи.

**Что такое фреймворк "ReAct" (Рассуждать и Действовать), упомянутый в этом контексте?** ReAct — это популярный фреймворк, который интегрирует рассуждение и действие. Агент следует циклу **Мысль** (рассуждение о том, что ему нужно сделать), **Действие** (решение, какой инструмент использовать и с какими входами), и **Наблюдение** (видение результата от инструмента). Этот цикл продолжается, пока он не соберет достаточно информации для выполнения запроса пользователя.

**Какие некоторые вызовы в реализации использования инструментов?** Ключевые вызовы включают:

- **Обработка ошибок:** Инструменты могут терпеть неудачу, возвращать неожиданные данные или таймаутиться. Агент должен быть способен распознавать эти ошибки и решать, попытаться ли снова, использовать другой инструмент или попросить пользователя о помощи.
- **Безопасность:** Давание агенту доступа к инструментам, особенно тем, которые выполняют действия, имеет последствия безопасности. Критично иметь защитные механизмы, разрешения и часто человеческое одобрение для чувствительных операций.
- **Промптинг:** Агент должен быть эффективно промптирован для генерации правильно форматированных вызовов инструментов (например, правильное имя функции и параметры).

**Что такое паттерн "Человек в контуре" (HITL)?** HITL — это паттерн, который интегрирует человеческий надзор и взаимодействие в рабочий процесс агента. Вместо того чтобы быть полностью автономным, агент останавливается в критических точках, чтобы попросить человеческую обратную связь, одобрение, уточнение или направление.

**Почему HITL важен для агентных систем?** Это критично по нескольким причинам:

- **Безопасность и контроль:** Для высокоставочных задач (например, финансовые транзакции, отправка официальных коммуникаций) HITL обеспечивает человеческую верификацию предложенных действий агента перед их выполнением.
- **Улучшение качества:** Люди могут предоставить коррекции или нюансированную обратную связь, которую агент может использовать для улучшения своей производительности, особенно в субъективных или неоднозначных задачах.
- **Построение доверия:** Пользователи более склонны доверять и принимать AI-систему, которую они могут направлять и контролировать.

**В каких точках рабочего процесса следует включать человека?** Общие точки для человеческого вмешательства включают:

- **Одобрение плана:** Перед выполнением многошагового плана.
- **Подтверждение использования инструмента:** Перед использованием инструмента, который имеет последствия в реальном мире или стоит денег.
- **Разрешение неоднозначности:** Когда агент не уверен, как продолжить или нуждается в дополнительной информации от пользователя.
- **Финальный обзор вывода:** Перед доставкой финального результата конечному пользователю или системе.

**Разве постоянное человеческое вмешательство не неэффективно?** Это может быть, поэтому ключ в нахождении правильного баланса. HITL должен быть реализован в критических контрольных точках, а не для каждого отдельного действия. Цель — построить совместное партнерство между человеком и агентом, где агент обрабатывает основную часть работы, а человек предоставляет стратегическое руководство.

**Что такое паттерн "Многоагентное сотрудничество"?** Этот паттерн включает создание системы, состоящей из множественных специализированных агентов, которые работают вместе для достижения общей цели. Вместо одного "универсального" агента, пытающегося делать все, вы создаете команду "специализированных" агентов, каждый со своей конкретной ролью или экспертизой.

**Каковы преимущества многоагентной системы?**

- **Модульность и специализация:** Каждый агент может быть тонко настроен и промптирован для своей конкретной задачи (например, агент-"исследователь", агент-"писатель", агент-"код"), приводя к более качественным результатам.
- **Уменьшенная сложность:** Разбиение сложного рабочего процесса на специализированные роли делает общую систему легче проектировать, отлаживать и поддерживать.
- **Симулированный мозговой штурм:** Разные агенты могут предлагать разные перспективы на проблему, приводя к более креативным и надежным решениям, подобно тому, как работает человеческая команда.

**Что такое общая архитектура для многоагентных систем?** Общая архитектура включает **Агента-оркестратора** (иногда называемого "менеджером" или "дирижером"). Оркестратор понимает общую цель, разбивает ее и делегирует подзадачи соответствующим специализированным агентам. Затем он собирает результаты от специалистов и синтезирует их в финальный вывод.

**Как агенты общаются друг с другом?** Коммуникация часто управляется оркестратором. Например, оркестратор может передать вывод агента-"исследователя" агенту-"писателю" как контекст. Общий "черновик" или шина сообщений, где агенты могут размещать свои находки, является другим общим методом коммуникации.

**Почему оценка агента более сложна, чем оценка традиционной программы?** Традиционное программное обеспечение имеет детерминированные выводы (тот же ввод всегда производит тот же вывод). Агенты, особенно те, которые используют LLM, недетерминированы, и их производительность может быть субъективной. Оценка их требует оценки _качества_ и _релевантности_ их вывода, а не просто того, технически ли он "правильный".

**Какие некоторые общие методы для оценки производительности агента?** Руководство предлагает несколько методов:

- **Оценка на основе результата:** Успешно ли агент достиг финальной цели? Например, если задачей было "забронировать рейс", был ли рейс фактически забронирован правильно? Это самая важная мера.
- **Оценка на основе процесса:** Был ли _процесс_ агента эффективным и логичным? Использовал ли он правильные инструменты? Следовал ли он разумному плану? Это помогает отлаживать, почему агент может терпеть неудачу.
- **Человеческая оценка:** Иметь людей оценивать производительность агента по шкале (например, 1-5) на основе критериев, таких как полезность, точность и связность. Это критично для пользовательских приложений.

**Что такое "траектория агента"?** Траектория агента — это полный лог шагов агента при выполнении задачи. Она включает все его мысли, действия (вызовы инструментов) и наблюдения. Анализ этих траекторий является ключевой частью отладки и понимания поведения агента.

**Как можно создать надежные тесты для недетерминированной системы?** Хотя вы не можете гарантировать точную формулировку вывода агента, вы можете создать тесты, которые проверяют ключевые элементы. Например, вы можете написать тест, который верифицирует, содержит ли финальный ответ агента конкретную информацию или успешно ли он вызвал определенный инструмент с правильными параметрами. Это часто делается с использованием мок-инструментов в выделенной тестовой среде.

**Чем промптинг агента отличается от простого промпта ChatGPT?** Промптинг агента включает создание детального "системного промпта" или конституции, которая действует как его операционные инструкции. Это выходит за рамки единственного пользовательского запроса; это определяет роль агента, его доступные инструменты, паттерны, которым он должен следовать (как ReAct или Планирование), его ограничения и его личность.

**Каковы ключевые компоненты хорошего системного промпта для агента?** Сильный системный промпт типично включает:

- **Роль и цель:** Четко определите, кто агент и какова его первичная цель.
- **Определения инструментов:** Список доступных инструментов, их описания и как их использовать (например, в специфическом формате вызова функций).
- **Ограничения и правила:** Явные инструкции о том, что агент _не должен_ делать (например, "Не используйте инструменты без одобрения", "Не предоставляйте финансовые советы").
- **Инструкции процесса:** Руководство по тому, какие паттерны использовать. Например, "Сначала создайте план. Затем выполните план пошагово."
- **Примеры траекторий:** Предоставление нескольких примеров успешных циклов "мысль-действие-наблюдение" может значительно улучшить надежность агента.

**Что такое "утечка промпта"?** Утечка промпта происходит, когда части системного промпта (как определения инструментов или внутренние инструкции) непреднамеренно раскрываются в финальном ответе агента пользователю. Это может смущать пользователя и раскрывать лежащие детали реализации. Техники, такие как использование отдельных промптов для рассуждения и для генерации финального ответа, могут помочь предотвратить это.

**Какие некоторые будущие тенденции в агентных системах?** Руководство указывает на будущее с:

- **Более автономными агентами:** Агентами, которые требуют меньше человеческого вмешательства и могут учиться и адаптироваться самостоятельно.
- **Высокоспециализированными агентами:** Экосистемой агентов, которых можно нанимать или подписываться на конкретные задачи (например, туристический агент, исследовательский агент).
- **Лучшими инструментами и платформами:** Развитием более изощренных фреймворков и платформ, которые делают легче создание, тестирование и развертывание надежных многоагентных систем.

---

## Навигация

**Назад:** [Благодарности](Благодарности.md)
