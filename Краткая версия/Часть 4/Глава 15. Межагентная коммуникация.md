# Глава 15: Межагентная коммуникация (A2A)

## Обзор паттерна

Agent2Agent (A2A) — открытый стандарт для взаимодействия между агентами ИИ, разработанными на разных фреймворках. Обеспечивает универсальную совместимость для координации, делегирования задач и обмена информацией.

**Поддерживающие компании:**
Atlassian, Box, LangChain, MongoDB, Salesforce, SAP, ServiceNow, Microsoft (Azure AI Foundry, Copilot Studio)

## Ключевые концепции

**Основные участники:**
- **User:** Инициирует запросы
- **A2A Client:** Агент, действующий от имени пользователя
- **A2A Server:** Удалённый агент с HTTP endpoint

**Agent Card:**
JSON-файл с метаданными агента:
```json
{
  "name": "WeatherBot",
  "description": "Weather forecasts and data",
  "url": "http://weather-service.com/a2a",
  "version": "1.0.0",
  "capabilities": {
    "streaming": true,
    "pushNotifications": false
  },
  "authentication": "OAuth2"
}
```

## Механизмы взаимодействия

1. **Обнаружение:** Динамическое обнаружение доступных агентов
2. **Делегирование:** Передача задач специализированным агентам
3. **Координация:** Управление мультиагентными рабочими процессами
4. **Обмен контекстом:** Передача состояния между агентами

## Практические применения

- **Корпоративная интеграция:** Агенты из разных систем (CRM, ERP, HR) сотрудничают
- **Распределённые исследования:** Специализированные агенты для поиска, анализа, суммаризации
- **Кроссплатформенные решения:** Агенты LangGraph, CrewAI, ADK работают вместе
- **Федеративные системы:** Агенты разных организаций взаимодействуют безопасно

## Практический пример кода

```python
# A2A Server (удалённый агент)
from flask import Flask, request, jsonify

app = Flask(__name__)

@app.route('/a2a', methods=['POST'])
def handle_a2a_request():
    data = request.json
    task = data.get('task')
    
    # Обработка задачи
    result = process_task(task)
    
    return jsonify({
        'status': 'completed',
        'result': result
    })

# A2A Client
import requests

class A2AClient:
    def __init__(self, agent_url):
        self.agent_url = agent_url
    
    def delegate_task(self, task):
        """Делегирование задачи удалённому агенту"""
        response = requests.post(
            f"{self.agent_url}/a2a",
            json={'task': task}
        )
        return response.json()

# Использование
client = A2AClient("http://weather-service.com")
result = client.delegate_task("Прогноз на завтра")
print(result)
```

## Безопасность

- **Аутентификация:** OAuth2, API keys
- **Авторизация:** Контроль доступа к возможностям
- **Шифрование:** HTTPS для передачи данных
- **Валидация:** Проверка входных данных

## Ключевые выводы

- A2A стандартизирует межагентное взаимодействие
- Открытый протокол для кроссплатформенной совместимости
- Agent Card определяет идентичность и возможности
- Поддерживает обнаружение, делегирование, координацию
- Критично для федеративных мультиагентных систем
- Широкая поддержка индустрии
- Обеспечивает масштабируемость агентных экосистем
