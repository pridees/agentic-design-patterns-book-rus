# Глава 11: Постановка целей и мониторинг

## Обзор паттерна

Постановка целей и мониторинг — паттерн, где агент работает с явно определёнными целями и отслеживает прогресс их достижения. Трансформирует агента из пассивного исполнителя в целеориентированную систему.

**Компоненты:**
- **Определение целей:** Чёткие, измеримые задачи
- **Декомпозиция:** Разбиение на подцели
- **Мониторинг:** Отслеживание прогресса
- **Адаптация:** Корректировка стратегии при отклонениях

## Процесс работы с целями

1. **Постановка:** Определение явных целей
2. **Планирование:** Создание стратегии достижения
3. **Выполнение:** Реализация плана
4. **Оценка:** Проверка соответствия целям
5. **Итерация:** Улучшение до достижения

## Практические применения

- **Генерация кода:** Цели по функциональности, качеству, тестированию
- **Создание контента:** Критерии по длине, стилю, охвату тем
- **Исследовательские задачи:** Полнота, точность, актуальность
- **Автоматизация процессов:** Метрики эффективности и качества

## Практический пример кода

```python
from langchain_openai import ChatOpenAI
from langchain_core.prompts import ChatPromptTemplate

llm = ChatOpenAI(model="gpt-4o", temperature=0.7)

class GoalOrientedAgent:
    def __init__(self, goals):
        self.goals = goals
        self.llm = llm
    
    def generate_code(self, task):
        """Генерация с учётом целей"""
        goals_text = "\n".join(f"- {g}" for g in self.goals)
        
        prompt = ChatPromptTemplate.from_template(
            """Создай код для задачи с учётом целей:
            
            Задача: {task}
            
            Цели:
            {goals}
            
            Код:"""
        )
        
        code = (prompt | self.llm).invoke({
            "task": task,
            "goals": goals_text
        })
        
        return code
    
    def evaluate_against_goals(self, code):
        """Проверка соответствия целям"""
        goals_text = "\n".join(f"- {g}" for g in self.goals)
        
        eval_prompt = ChatPromptTemplate.from_template(
            """Оцени, достигнуты ли цели:
            
            Цели:
            {goals}
            
            Код:
            {code}
            
            Ответь: True или False"""
        )
        
        result = (eval_prompt | self.llm).invoke({
            "goals": goals_text,
            "code": code
        })
        
        return "true" in result.content.lower()
    
    def iterative_improvement(self, task, max_iterations=3):
        """Итеративное улучшение до достижения целей"""
        for i in range(max_iterations):
            code = self.generate_code(task)
            
            if self.evaluate_against_goals(code):
                print(f"Цели достигнуты на итерации {i+1}")
                return code
            
            print(f"Итерация {i+1}: цели не достигнуты, улучшаем...")
        
        return code

# Использование
agent = GoalOrientedAgent(goals=[
    "Код должен быть хорошо документирован",
    "Функции должны иметь проверку типов",
    "Должны быть обработаны ошибки"
])

result = agent.iterative_improvement(
    "Создай функцию для чтения JSON-файла"
)
print(result)
```

## Типы целей

1. **Функциональные:** Что должна делать система
2. **Качественные:** Как должно быть выполнено
3. **Временные:** Сроки выполнения
4. **Ресурсные:** Ограничения по ресурсам

## Метрики мониторинга

- **Прогресс:** Процент выполнения подцелей
- **Качество:** Соответствие критериям качества
- **Эффективность:** Использование ресурсов
- **Точность:** Соответствие ожиданиям

## Связь с другими паттернами

- **Рефлексия (Глава 4):** Использует цели для самооценки
- **Планирование (Глава 6):** Цели направляют планирование
- **Адаптация (Глава 9):** Мониторинг обеспечивает обратную связь

## Ключевые выводы

- Цели делают агента проактивным и целеориентированным
- Мониторинг отслеживает прогресс достижения
- Итеративный процесс: генерация → оценка → улучшение
- Эффективно для кода, контента, исследований
- Интегрируется с рефлексией, планированием, адаптацией
- Обеспечивает измеримость и подотчётность агента
