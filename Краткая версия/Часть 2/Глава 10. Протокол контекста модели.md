# Глава 10: Протокол контекста модели (MCP)

## Обзор паттерна

Model Context Protocol (MCP) — открытый стандарт для стандартизации взаимодействия LLM с внешними приложениями, источниками данных и инструментами. Универсальный механизм подключения для агентных систем.

**Архитектура клиент-сервер:**
- **MCP-сервер:** Предоставляет ресурсы, промпты и инструменты
- **MCP-клиент:** Приложение с LLM, потребляющее возможности сервера

## MCP vs Tool Function Calling

| Аспект | Tool Function Calling | MCP |
|--------|----------------------|-----|
| **Стандартизация** | Проприетарный | Открытый стандарт |
| **Область** | Прямой вызов функции | Широкая экосистема |
| **Архитектура** | Один-к-одному | Клиент-сервер |
| **Интероперабельность** | Специфична для поставщика | Кросс-платформенная |
| **Обнаружение** | Статическое | Динамическое |

## Ключевые преимущества

1. **Универсальность:** Любая LLM с любым инструментом
2. **Модульность:** Переиспользование компонентов
3. **Масштабируемость:** Лёгкое добавление новых возможностей
4. **Совместимость:** Работа с устаревшими системами

## Компоненты MCP

**Ресурсы:** Данные, доступные агенту
- Файловые системы
- Базы данных
- API-endpoints

**Промпты:** Интерактивные шаблоны
- Предопределённые сценарии
- Параметризованные запросы

**Инструменты:** Исполняемые функции
- Поиск
- Вычисления
- Внешние действия

## Практический пример кода

```python
# Пример MCP-сервера
from mcp.server import Server, Resource, Tool
from mcp.types import TextContent

class MyMCPServer(Server):
    def __init__(self):
        super().__init__("my-service")
        
    @Resource("config://settings")
    async def get_settings(self) -> TextContent:
        """Предоставление конфигурации"""
        return TextContent(
            text="Setting1: Value1\nSetting2: Value2"
        )
    
    @Tool("search")
    async def search(self, query: str) -> TextContent:
        """Инструмент поиска"""
        results = f"Результаты для: {query}"
        return TextContent(text=results)

# Пример MCP-клиента
from mcp.client import Client

async def use_mcp_server():
    client = Client()
    await client.connect("http://localhost:8000")
    
    # Получение ресурса
    settings = await client.get_resource("config://settings")
    
    # Вызов инструмента
    results = await client.call_tool("search", query="AI agents")
    
    print(settings, results)
```

## Важные соображения

**Дизайн API:**
- Базовый API должен быть агент-дружественным
- Детерминистические функции (фильтрация, сортировка) для эффективности
- Формат данных должен быть понятен агенту (Markdown лучше PDF)

**Безопасность:**
- Аутентификация и авторизация
- Валидация входных данных
- Ограничение доступа к ресурсам

## Ключевые выводы

- MCP стандартизирует взаимодействие LLM с внешними системами
- Открытый протокол для интероперабельности
- Клиент-серверная архитектура
- Предоставляет ресурсы, промпты и инструменты
- Требует агент-дружественного дизайна API
- Облегчает федеративную модель интеграции
- Снижает сложность построения агентных систем
