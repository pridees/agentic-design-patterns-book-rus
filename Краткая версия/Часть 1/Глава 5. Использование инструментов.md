# Глава 5: Использование инструментов

## Обзор паттерна

Использование инструментов (Tool Use) расширяет возможности LLM за пределы обучающих данных через интеграцию с внешними функциями, API и сервисами. LLM определяет, какой инструмент вызвать, формирует параметры и интерпретирует результат.

**Ключевые компоненты:**
- **Определение инструментов:** Описание функций, параметров и возвращаемых значений
- **Вызов инструментов:** LLM решает, когда и как использовать инструмент
- **Интеграция результатов:** Включение выхода инструмента в ответ

## Типы инструментов

1. **Поиск информации:** Веб-поиск, базы данных, API
2. **Вычисления:** Калькуляторы, анализ данных
3. **Внешние действия:** Отправка email, создание файлов, API-вызовы
4. **Специализированные:** Генерация изображений, распознавание речи, код-интерпретация

## Практические применения

- **Научные ассистенты:** Поиск актуальной информации, выход за рамки обучающих данных
- **Автоматизация задач:** Email, календарь, CRM-системы
- **Анализ данных:** SQL-запросы, визуализации
- **Программирование:** Выполнение кода, тестирование
- **Мультимодальность:** Генерация/анализ изображений, аудио

## Практический пример кода

```python
from langchain.agents import Tool, initialize_agent, AgentType
from langchain_openai import ChatOpenAI
from langchain.tools import DuckDuckGoSearchRun

llm = ChatOpenAI(model="gpt-4o", temperature=0)

# Определение инструментов
search = DuckDuckGoSearchRun()

def calculator(expression: str) -> str:
    """Вычисляет математическое выражение"""
    try:
        return str(eval(expression))
    except:
        return "Ошибка вычисления"

tools = [
    Tool(
        name="Search",
        func=search.run,
        description="Поиск актуальной информации в интернете"
    ),
    Tool(
        name="Calculator",
        func=calculator,
        description="Вычисление математических выражений"
    )
]

# Создание агента
agent = initialize_agent(
    tools=tools,
    llm=llm,
    agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION,
    verbose=True
)

# Использование
result = agent.run(
    "Найди население Москвы и вычисли 10% от этого числа"
)
print(result)
```

## Важные аспекты

- **Безопасность:** Валидация входов, ограничение разрешений
- **Обработка ошибок:** Корректная реакция на сбои инструментов
- **Описания:** Чёткие описания помогают LLM правильно выбирать инструменты
- **Детерминированность:** Критичные операции должны быть надёжными

## Ключевые выводы

- Использование инструментов расширяет LLM за пределы обучающих данных
- Агент выбирает инструмент, формирует параметры и интегрирует результат
- Поддерживает поиск, вычисления, внешние действия, мультимодальность
- Требует чётких описаний и обработки ошибок
- Фундаментален для практических агентных приложений
