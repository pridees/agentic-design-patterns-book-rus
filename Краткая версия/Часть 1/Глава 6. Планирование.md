# Глава 6: Планирование

## Обзор паттерна

Планирование — способность агента декомпозировать сложные задачи на подзадачи и выстраивать стратегию выполнения. Вместо реактивного ответа агент проактивно создаёт план достижения цели.

**Типы планирования:**
- **Однократное (Single-shot):** Полный план создаётся заранее
- **Последовательное (Sequential):** План формируется пошагово
- **Адаптивное (Adaptive):** План корректируется на основе результатов

## Подходы к планированию

1. **ReAct (Reasoning and Acting):** Чередование рассуждения и действия
   - Мысль → Действие → Наблюдение → Повтор

2. **Plan-and-Execute:** Разделение на планирование и исполнение
   - Создание полного плана → Последовательное выполнение

3. **Tree-of-Thoughts:** Исследование нескольких путей решения
   - Генерация вариантов → Оценка → Выбор лучшего

## Практические применения

- **Исследовательские задачи:** Разбиение вопроса на подвопросы и последовательное исследование
- **Автоматизация рабочих процессов:** Планирование шагов для сложных бизнес-задач
- **Программирование:** Декомпозиция задачи на модули и функции
- **Планирование проектов:** Создание временной шкалы и зависимостей
- **Робототехника:** Планирование последовательности действий

## Практический пример кода

```python
from langchain.agents import create_react_agent, AgentExecutor
from langchain_openai import ChatOpenAI
from langchain.prompts import PromptTemplate
from langchain.tools import Tool

llm = ChatOpenAI(model="gpt-4o", temperature=0)

# Определение инструментов
tools = [
    Tool(
        name="WebSearch",
        func=lambda q: f"Результаты поиска для: {q}",
        description="Поиск информации в интернете"
    ),
    Tool(
        name="Calculator",
        func=lambda expr: str(eval(expr)),
        description="Вычисления"
    )
]

# ReAct-промпт
template = """Используй следующий формат:

Question: входной вопрос
Thought: размышление о том, что делать
Action: действие из [{tool_names}]
Action Input: вход для действия
Observation: результат действия
... (повтор Thought/Action/Observation)
Thought: теперь я знаю ответ
Final Answer: итоговый ответ

Question: {input}
{agent_scratchpad}"""

prompt = PromptTemplate(
    template=template,
    input_variables=["input", "agent_scratchpad", "tool_names"]
)

agent = create_react_agent(llm, tools, prompt)
executor = AgentExecutor(agent=agent, tools=tools, verbose=True)

result = executor.invoke({
    "input": "Найди население Токио и вычисли его удвоенное значение"
})
print(result["output"])
```

## Ключевые выводы

- Планирование декомпозирует сложные задачи на управляемые подзадачи
- ReAct чередует рассуждение и действие для адаптивного планирования
- Plan-and-Execute разделяет планирование и исполнение
- Tree-of-Thoughts исследует множественные пути решения
- Эффективно для исследований, автоматизации, программирования
- Позволяет агентам проактивно достигать целей
