# Глава 17: Техники рассуждения

## Обзор паттерна

Техники рассуждения улучшают способность LLM к логическому мышлению и решению сложных задач через структурированные подходы к обработке информации и генерации выводов.

## Ключевые техники

**1. Chain-of-Thought (CoT):**
- Пошаговое рассуждение
- "Давай подумаем шаг за шагом"
- Делает процесс мышления явным

**2. Tree-of-Thoughts (ToT):**
- Исследование множественных путей
- Оценка промежуточных состояний
- Выбор наиболее перспективного пути

**3. Self-Consistency:**
- Генерация нескольких решений
- Голосование за наиболее частый ответ
- Повышение надёжности

**4. Least-to-Most:**
- Разбиение на подзадачи
- Решение от простого к сложному
- Использование предыдущих решений

## Практические применения

- **Математика:** Пошаговое решение уравнений
- **Логические задачи:** Структурированный анализ
- **Программирование:** Декомпозиция алгоритмов
- **Анализ текста:** Многоуровневое понимание

## Практический пример кода

```python
from langchain_openai import ChatOpenAI
from langchain_core.prompts import ChatPromptTemplate

llm = ChatOpenAI(model="gpt-4o", temperature=0.7)

# Chain-of-Thought
cot_prompt = ChatPromptTemplate.from_template(
    """Реши задачу пошагово:
    
    Задача: {problem}
    
    Давай подумаем шаг за шагом:
    1."""
)

# Tree-of-Thoughts
tot_prompt = ChatPromptTemplate.from_template(
    """Рассмотри несколько подходов к задаче:
    
    Задача: {problem}
    
    Подход 1: [описание]
    Подход 2: [описание]
    Подход 3: [описание]
    
    Оцени каждый и выбери лучший."""
)

# Self-Consistency
def self_consistency(problem, n=5):
    """Генерация N решений и выбор наиболее частого"""
    solutions = []
    for _ in range(n):
        result = (cot_prompt | llm).invoke({"problem": problem})
        solutions.append(result.content)
    
    # Простое голосование (в реальности нужен парсинг)
    from collections import Counter
    return Counter(solutions).most_common(1)[0][0]

# Использование
problem = "В корзине 15 яблок. Взяли 40%. Сколько осталось?"
result = self_consistency(problem)
print(result)
```

## Продвинутые техники

**1. ReAct (Reasoning + Acting):**
- Чередование мышления и действия
- Thought → Action → Observation

**2. Reflection:**
- Самооценка и улучшение
- Критический анализ собственных решений

**3. Multi-hop Reasoning:**
- Цепочка логических выводов
- Интеграция информации из множества источников

## Ключевые выводы

- CoT делает рассуждение явным и пошаговым
- ToT исследует альтернативные пути решения
- Self-Consistency повышает надёжность через голосование
- Least-to-Most декомпозирует сложные задачи
- ReAct интегрирует рассуждение и действие
- Критично для математики, логики, программирования
- Улучшает точность на сложных задачах
